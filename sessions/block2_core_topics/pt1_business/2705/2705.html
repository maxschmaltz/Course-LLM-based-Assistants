<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" /><link rel="next" title="22.05. Virtual Assistants Pt. 3: Multi-agent Environment" href="../2205.html" /><link rel="prev" title="20.05. RAG Chatbot Pt. 2 📚" href="../2005/2005.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>27.05. Multi-agent Environment 👾🤖👾 - LLM-based Assistants</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">LLM-based Assistants</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">LLM-based Assistants</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Infos and Stuff</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../infos/topic_overview.html">Topics Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infos/formats/debates.html">Debates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infos/formats/pitches.html">Pitches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infos/llm_inference_guide/README.html">LLM Inference Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Block 1: Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../block1_intro/2204.html">22.04. LLMs as a Form of Intelligence vs LLMs as Statistical Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block1_intro/2404.html">24.04. LLM &amp; Agent Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block1_intro/2904/2904.html">29.04. Intro to LangChain 🦜🔗</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Block 2: Core Topics | Part 1: Business Applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0605.html">06.05. Virtual Assistants Pt. 1: Chatbots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0805/0805.html">08.05. Basic LLM-based Chatbot 🤖</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1305.html">13.05. Virtual Assistants Pt. 2: RAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1505/1505.html">15.05. RAG Chatbot Pt. 1 📚</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2005/2005.html">20.05. RAG Chatbot Pt. 2 📚</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">27.05. Multi-agent Environment 👾🤖👾</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2205.html">22.05. Virtual Assistants Pt. 3: Multi-agent Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0306.html">03.06. LLMs in Software Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../0506/0506.html">05.06. LLM-powered Website 💻</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Block 2: Core Topics | Part 2: Applications in Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pt2_science/under_development.html">Under development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Block 3: Wrap-up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../block3_wrapup/under_development.html">Under development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pitches</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../pitches/2406/README.html">24.06. <em>Pitch</em>: RAG Chatbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pitches/2606/README.html">26.06. <em>Pitch</em>: Handling Customer Requests in a Multi-agent Environment</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="multi-agent-environment">
<h1>27.05. Multi-agent Environment 👾🤖👾<a class="headerlink" href="#multi-agent-environment" title="Link to this heading">¶</a></h1>
<p>📍 <a class="reference external" href="https://github.com/maxschmaltz/Course-LLM-based-Assistants/tree/main/llm-based-assistants/sessions/block2_core_topics/pt1_business/2705">Download notebook and session files</a></p>
<p>In today’l lab, we will create a multi-agent environment for automated meeting scheduling and preparation. We will see how the coordinator agent will communicate with two auxiliary agents to check time availability and prepare an agenda for the meeting.</p>
<p>Our plan for today:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#agents"><span class="xref myst">Creating an Agent</span></a></p></li>
<li><p><a class="reference internal" href="#lama"><span class="xref myst">Centralized Multi-agent System</span></a></p></li>
<li><p><a class="reference internal" href="#human"><span class="xref myst">Human in The Loop</span></a></p></li>
</ul>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>To start with the tutorial, complete the steps <a class="reference internal" href="#../../../infos/llm_inference_guide/README.md#prerequisites"><span class="xref myst">Prerequisites</span></a>, <a class="reference internal" href="#../../../infos/llm_inference_guide/README.md#environment-setup"><span class="xref myst">Environment Setup</span></a>, and <a class="reference internal" href="#../../../infos/llm_inference_guide/README.md#getting-api-key"><span class="xref myst">Getting API Key</span></a> from the <a class="reference internal" href="#../../../infos/llm_inference_guide/README.md"><span class="xref myst">LLM Inference Guide</span></a>.</p>
<p>Then install the dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>Then as always, we will initialize our LLM first. This time, we will be using <a class="reference external" href="https://build.nvidia.com/meta/llama-3_1-405b-instruct">llama-3.1-405b-instruct</a> because ir handles multiple tools better (remember that a newer mode doesn’t necessarily means better model, at least for some tasks).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_nvidia_ai_endpoints</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatNVIDIA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.rate_limiters</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryRateLimiter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read system variables</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dotenv</span>

<span class="n">dotenv</span><span class="o">.</span><span class="n">load_dotenv</span><span class="p">()</span>    <span class="c1"># that loads the .env file variables into os.environ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># choose any model, catalogue is available under https://build.nvidia.com/models</span>
<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s2">&quot;meta/llama-3.1-405b-instruct&quot;</span>

<span class="c1"># this rate limiter will ensure we do not exceed the rate limit</span>
<span class="c1"># of 40 RPM given by NVIDIA</span>
<span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">InMemoryRateLimiter</span><span class="p">(</span>
    <span class="n">requests_per_second</span><span class="o">=</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># 3 requests per minute (this model allows much less requests)</span>
    <span class="n">check_every_n_seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># wake up every 100 ms to check whether allowed to make a request,</span>
    <span class="n">max_bucket_size</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># controls the maximum burst size</span>
<span class="p">)</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatNVIDIA</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">MODEL_NAME</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;NVIDIA_API_KEY&quot;</span><span class="p">),</span> 
    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>   <span class="c1"># ensure reproducibility,</span>
    <span class="n">rate_limiter</span><span class="o">=</span><span class="n">rate_limiter</span>  <span class="c1"># bind the rate limiter</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<h2 id="agents">1. Creating an Agent 👾</h2>
<p>Recap: a raw (textual) LLM can only generate text, is limited to what’s in its training data, and can only give you a single response. An agent overcomes this limitations by attaching tools, memory, and often access to external data sources to the LLM. This means agents can take actions, remember previous interactions, use APIs, and iteratively work through complex problems by deciding what to do next based on intermediate results.</p>
<p>LangGraph thinks about agents in a simple way: they are a construct out of three key components: the LLM itself, the tools, and the looping logic (Observe–Plan–Act workflow). This creates a cycle where the agent can:</p>
<ul class="simple">
<li><p>Think about the problem</p></li>
<li><p>Decide which tool to use</p></li>
<li><p>Use the tool and see the result</p></li>
<li><p>Think about whether it’s done or needs to do more</p></li>
<li><p>Repeat until the task is complete</p></li>
</ul>
<p><img alt="image.png" src="sessions/block2_core_topics/pt1_business/2705/attachment:image.png" /></p>
<p>LangChain comes with a number of prebuilt agentic implementations; they can be considered as templates for the graphs to implement the logic above: you only need to pass the LLM, the tools, and the prompt, and the rest will be made for you.</p>
<p>We will now create a very basic agent that can do simple math operations and count length. This will help us understand the core concepts without getting too deep in complex functionality (yet).</p>
<p>We had initialized the LLM above, so now it’s time for the tools. Remember that LangChain reads out the docstring and the type annotations to determine when to use this tool so don’t forget to include those in your functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add two numbers together.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">multiply_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiply two numbers together.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>


<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_word_length</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the length of a word.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>


<span class="c1"># put together</span>
<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_numbers</span><span class="p">,</span> <span class="n">multiply_numbers</span><span class="p">,</span> <span class="n">get_word_length</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>To initialize the agent quickly, we use the <a class="reference external" href="https://langchain-ai.github.io/langgraph/reference/agents/#langgraph.prebuilt.chat_agent_executor.create_react_agent"><code class="docutils literal notranslate"><span class="pre">create_react_agent</span></code></a> method from LangGraph; as mentioned before, it takes the LLM, the tools, and the couple of more parameters as the input and returns a fully functional graph with the Observe–Plan–Act workflow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_basic_agent_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Answer user questions using the provided tools. </span><span class="se">\</span>
<span class="s2">Always plan ahead first, then execute the plan step by step. </span><span class="se">\</span>
<span class="s2">If you face a complex task, break it down into smaller steps. </span><span class="se">\</span>
<span class="s2">You may use only one tool per action. </span><span class="se">\</span>
<span class="s2">Return only the results with no additional text.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">basic_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">_basic_agent_prompt</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_graph</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">output_file_path</span><span class="p">:</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># draw the graph</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">graph_image</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">draw_mermaid_png</span><span class="p">(</span>
            <span class="n">output_file_path</span><span class="o">=</span><span class="n">output_file_path</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">graph_image</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_graph</span><span class="p">(</span><span class="n">basic_agent</span><span class="p">,</span> <span class="s2">&quot;basic_agent.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/53c8193f4986405452b91745d76399bdee0811ac683913555ea84c0dcfc9b24b.png" src="../../../../_images/53c8193f4986405452b91745d76399bdee0811ac683913555ea84c0dcfc9b24b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># wrapper for pretty print</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">recursion_limit</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)]</span>
    <span class="p">}</span>
    <span class="n">shown_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
        <span class="nb">input</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;recursion_limit&quot;</span><span class="p">:</span> <span class="n">recursion_limit</span><span class="p">},</span>
        <span class="n">stream_mode</span><span class="o">=</span><span class="s2">&quot;values&quot;</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">shown_messages</span><span class="p">:</span>
                    <span class="n">shown_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_agent</span><span class="p">(</span><span class="n">basic_agent</span><span class="p">,</span> <span class="s2">&quot;I need to calculate (523 + 32) * 28 and get the length of the resulting number spelled out.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

I need to calculate (523 + 32) * 28 and get the length of the resulting number spelled out.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Tool Calls:
  add_numbers (chatcmpl-tool-79717782d33c483ea2a0484f3511da4b)
 Call ID: chatcmpl-tool-79717782d33c483ea2a0484f3511da4b
  Args:
    a: 523
    b: 32


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: add_numbers

555.0


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Tool Calls:
  multiply_numbers (chatcmpl-tool-ed46f917137f4af09c2ab00079b22b88)
 Call ID: chatcmpl-tool-ed46f917137f4af09c2ab00079b22b88
  Args:
    a: 555
    b: 28


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: multiply_numbers

15540.0


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Tool Calls:
  get_word_length (chatcmpl-tool-ec58f78d2db1460a85c3148db3f00c68)
 Call ID: chatcmpl-tool-ec58f78d2db1460a85c3148db3f00c68
  Args:
    word: fifteenthousandfivehundredforty


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: get_word_length

31


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

The length of the word is 31.
</pre></div>
</div>
</div>
</div>
<p>Please note that this implementation will always try to call tools until the answer is reached, which may be inadequate for some applications.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_agent</span><span class="p">(</span><span class="n">basic_agent</span><span class="p">,</span> <span class="s2">&quot;What is the 5th largest country?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

What is the 5th largest country?


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

I can&#39;t answer that question with the tools I have available.
</pre></div>
</div>
</div>
</div>
<p>As you can see, the default <code class="docutils literal notranslate"><span class="pre">create_react_agent</span></code> implementation is not optimal as it always tries to call a tool. To address this issue, we will insert a so-called <code class="docutils literal notranslate"><span class="pre">pre_model_hook</span></code>: a function that is called before the LLM. This function is a usual LangGraph node that is just incorporated in the default implementation.</p>
<p>In our case, we will make the LLM first plan the next action explicitly and then generate itself a command for the next action.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_text_description</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.prompts</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatPromptTemplate</span><span class="p">,</span> <span class="n">MessagesPlaceholder</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tools_description</span> <span class="o">=</span> <span class="n">render_text_description</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>

<span class="n">_plan_next_instruction</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are an agent who has access to the following tools:</span>


<span class="si">{</span><span class="n">tools_description</span><span class="si">}</span>


<span class="s2">Your task is to define best next action based on the previous messages </span><span class="se">\</span>
<span class="s2">and the tools available. You can either call one tool or </span><span class="se">\</span>
<span class="s2">return a text message to the user.</span>

<span class="s2">Return the next action you think is best to take as a textual description. </span><span class="se">\</span>
<span class="s2">Only return the single next action and not the whole plan.</span>


<span class="s2">Examples:</span>

<span class="s2">User: What is 2 + 2?</span>
<span class="s2">Assistant: Call the add_numbers tool with arguments 2 and 2.</span>


<span class="s2">User: What is the 5th largest country?</span>
<span class="s2">Assistant: Generate the answer yourself and exit, no tool calls are needed here.</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="n">_plan_next_prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="n">_plan_next_instruction</span><span class="p">),</span>
        <span class="n">MessagesPlaceholder</span><span class="p">(</span><span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;messages&quot;</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plan_next</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="n">plan_next_prompt</span> <span class="o">=</span> <span class="n">_plan_next_prompt</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">next_action</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">plan_next_prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">next_action</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basic_plus_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="n">pre_model_hook</span><span class="o">=</span><span class="n">plan_next</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_graph</span><span class="p">(</span><span class="n">basic_plus_agent</span><span class="p">,</span> <span class="s2">&quot;basic_plus_agent.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/0752bca1ddbc78be91405fe82a71828e31356ddd0d5df7f877c324fee73e122c.png" src="../../../../_images/0752bca1ddbc78be91405fe82a71828e31356ddd0d5df7f877c324fee73e122c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_agent</span><span class="p">(</span><span class="n">basic_plus_agent</span><span class="p">,</span> <span class="s2">&quot;I need to calculate (523 + 32) * 28 and get the length of the resulting number spelled out.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

I need to calculate (523 + 32) * 28 and get the length of the resulting number spelled out.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

Call the add_numbers tool with arguments 523 and 32.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Tool Calls:
  add_numbers (chatcmpl-tool-71cde0654b3f4b64bb80d9032f3ace00)
 Call ID: chatcmpl-tool-71cde0654b3f4b64bb80d9032f3ace00
  Args:
    a: 523
    b: 32


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: add_numbers

555.0


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

Call the multiply_numbers tool with arguments 555 and 28.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Tool Calls:
  multiply_numbers (chatcmpl-tool-089a91c23834474ea8902528c58af0af)
 Call ID: chatcmpl-tool-089a91c23834474ea8902528c58af0af
  Args:
    a: 555
    b: 28


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: multiply_numbers

15540.0


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

Call the get_word_length tool with the argument &quot;fifteen thousand five hundred forty&quot;.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Tool Calls:
  get_word_length (chatcmpl-tool-8f0a26d21b1540a284d8383ece2f27c5)
 Call ID: chatcmpl-tool-8f0a26d21b1540a284d8383ece2f27c5
  Args:
    word: fifteen thousand five hundred forty


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: get_word_length

35


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

Return the answer &quot;35&quot;.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

35
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_agent</span><span class="p">(</span><span class="n">basic_plus_agent</span><span class="p">,</span> <span class="s2">&quot;When is the apocalypse happening?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

When is the apocalypse happening?


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

Generate the answer yourself and exit, no tool calls are needed here.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================

I&#39;m not aware of any information that suggests the apocalypse is happening on a specific date. The concept of the apocalypse is often associated with religious or mythological beliefs, and its timing is not something that can be predicted with certainty. It&#39;s best to focus on living in the present and working towards creating a better future for all, rather than worrying about a hypothetical apocalyptic event.
</pre></div>
</div>
</div>
</div>
<h2 id="lama">2. Centralized Multi-agent System 👾🤖👾</h2>
<p>In this section, we’ll create a multi-agent system for automated meeting scheduling and preparation. Our system will consist of three specialized agents:</p>
<ul class="simple">
<li><p><em>Scheduler Agent</em> - checks the availabilities of required participants and selects time slots that work for everyone</p></li>
<li><p><em>Creative Agent</em> - reviews the project plan and generates a comprehensive agenda for the meeting</p></li>
<li><p><em>Coordinator Agent</em> - orchestrates the other two agents, deciding when to call each one and combining their outputs</p></li>
</ul>
<p>This will demonstrate how different agents can collaborate, each with their own expertise, to solve complex problems that would be difficult for a single agent to handle efficiently.</p>
<section id="executor-agents">
<h3>Executor Agents<a class="headerlink" href="#executor-agents" title="Link to this heading">¶</a></h3>
<p>For this tutorial, we’re focusing on understanding the multi-agent <strong>workflow</strong> and coordination patterns, so to avoid losing time for configuration of actual API integrations and external dependencies, we’ll implement dummy functions that simulate real-world services. We will respectively create a dummy calendar function that will output random hourly time slots, and a dummy RAG function that will simulate the process of retrieving relevant information about the project for agenda preparation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_calendar_availability</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieving availability of the worker from their calendar.</span>
<span class="sd">    Returns a list of available time slots for a given person.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        name: The person&#39;s name to check availability for</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        List of available time slots as strings (e.g., [&quot;14:00-15:00&quot;, &quot;15:30-16:30&quot;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># generate all possible hourly slots from 10:00-11:00 to 17:00-18:00 (increments by 30 minutes)</span>
    <span class="n">all_slots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_hour</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">end_hour</span> <span class="o">=</span> <span class="mi">17</span>
    
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_hour</span><span class="p">,</span> <span class="n">end_hour</span><span class="p">):</span>
        <span class="n">all_slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00-</span><span class="si">{</span><span class="n">hour</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00&quot;</span><span class="p">)</span>
        <span class="n">all_slots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:30-</span><span class="si">{</span><span class="n">hour</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:30&quot;</span><span class="p">)</span>
    
    <span class="c1"># randomly select 2-5 available slots for this person;</span>
    <span class="c1"># since this is a dummy random function,</span>
    <span class="c1"># we won&#39;t use the name since there&#39;s no real calendar to check,</span>
    <span class="c1"># but the agent doesn&#39;t know that</span>
    <span class="n">num_available</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">available_slots</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">all_slots</span><span class="p">,</span> <span class="n">num_available</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">available_slots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_project_state</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Current Project: Mobile App Redesign (Q2 2024)</span>

<span class="s2">Status: In Progress (Week 6 of 12)</span>

<span class="s2">Recent Milestones:</span>
<span class="s2">- User research completed (Week 3)</span>
<span class="s2">- Wireframes approved by stakeholders (Week 5)</span>
<span class="s2">- Initial design mockups completed (Week 6)</span>

<span class="s2">Upcoming Milestones:</span>
<span class="s2">- Prototype development (Week 8-10)</span>
<span class="s2">- User testing sessions (Week 11)</span>
<span class="s2">- Final design handoff (Week 12)</span>

<span class="s2">Current Blockers:</span>
<span class="s2">- Waiting for brand guidelines update from marketing team</span>
<span class="s2">- Need approval on accessibility requirements</span>

<span class="s2">Budget Status: 70</span><span class="si">% u</span><span class="s2">tilized, on track</span>
<span class="s2">Timeline Status: Slightly behind schedule due to extended user research phase</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">retrieve_project_information</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query the internal documents to retrieve relevant project information.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        query: The information being requested about the project</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Project information as a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">_project_state</span>   <span class="c1"># make it static</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s create our two executor agents, each with access to their respective tools:</p>
<ul class="simple">
<li><p>We’ll bind the <em>Scheduler Agent</em> with the dummy calendar function</p></li>
<li><p>We’ll bind the <em>Creative Agent</em> with the dummy RAG function</p></li>
</ul>
<p>For these two agents, we’ll use the <code class="docutils literal notranslate"><span class="pre">create_react_agent</span></code> again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_scheduler_agent_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">You are a scheduling assistant. Your job is to check participant availability </span><span class="se">\</span>
<span class="s2">and find time slots that work for everyone. You will be given the list of participants </span><span class="se">\</span>
<span class="s2">and your task is to find the shared available time slots for a meeting -- </span><span class="se">\</span>
<span class="s2">that is, time slots that are available for all participants. </span><span class="se">\</span>
<span class="s2">Only return the common slots as a list of strings </span><span class="se">\</span>
<span class="s2">(e.g., [&quot;14:00-15:00&quot;, &quot;15:30-16:30&quot;]). </span><span class="se">\</span>
<span class="s2">If there are no common slots, say &quot;No common slots available&quot;.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">scheduler_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> 
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">check_calendar_availability</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">_scheduler_agent_prompt</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scheduler_agent&quot;</span>  <span class="c1"># add names for the coordinator</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_creative_agent_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are a meeting preparation assistant. Your job is to create comprehensive meeting agendas </span><span class="se">\</span>
<span class="s2">based on current project status and goals. Always retrieve the latest project information first.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">creative_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">retrieve_project_information</span><span class="p">],</span> 
    <span class="n">prompt</span><span class="o">=</span><span class="n">_creative_agent_prompt</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;creative_agent&quot;</span>  <span class="c1"># add names for the coordinator</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="coordinator-agent">
<h3>Coordinator Agent<a class="headerlink" href="#coordinator-agent" title="Link to this heading">¶</a></h3>
<p>A coordinator agent (also called a supervisor, or an orchestrator) is a special type of agent that doesn’t perform tasks directly. Instead, it decides which other agents should work on different parts of a complex request. The coordinator analyzes incoming requests, breaks them down into subtasks, assigns those subtasks to the appropriate agents, and then combines the results into a final response.</p>
<p>A separate package <a class="reference external" href="https://langchain-ai.github.io/langgraph/agents/multi-agent/#supervisor"><code class="docutils literal notranslate"><span class="pre">langgraph-supervisor</span></code></a> allows us to create a coordinator agent from a template; the default implementation work the following way:</p>
<ol class="arabic simple">
<li><p>The coordinator gets the input from the user / the last executor</p></li>
<li><p>The coordinator decides which agent should step in next</p></li>
<li><p>The chosen executor gets the whole message history and generates the output</p></li>
<li><p>The output is returned to the coordinator, and the process loops</p></li>
</ol>
<p>This implementation is not optimal because 1) there is no information segregation (all agents see the same messages); 2) the executors should decide themselves what exactly to do =&gt; no real coordination is going on. To address that, we’ll customize the coordinator with a so-called <em>handoff function</em> – that is the function that defines what the output of the supervisor looks like. Namely, we’ll have our coordinator generate specific textual commands for the executors, and limit the informational scope of the executors to those commands. So now the workflow will look like this:</p>
<ol class="arabic simple">
<li><p>The coordinator gets the input from the user / the last executor</p></li>
<li><p>The coordinator decides which agent should step in next</p></li>
<li><p>The coordinator generates a specific task for the next agent</p></li>
<li><p>The chosen executor gets only this command and generates the output</p></li>
<li><p>The output is returned to the coordinator, and the process loops</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.messages</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIMessage</span><span class="p">,</span> <span class="n">HumanMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">InjectedState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Send</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_task_description_handoff_tool</span><span class="p">(</span><span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transfer_to_</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># name of the tool</span>

    <span class="nd">@tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handoff_tool</span><span class="p">(</span>
        <span class="c1"># this will be populated by the coordinator;</span>
        <span class="c1"># the coordinator will see in the docstring that this</span>
        <span class="c1"># tool needs a task description to be passed so it </span>
        <span class="c1"># will generate one as the required parameter</span>
        <span class="n">task_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="c1"># the `InjectedState` annotation will ensure that the</span>
        <span class="c1"># current state will be passed to the tool</span>
        <span class="c1"># and this parameter will be ignored by the LLM</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">InjectedState</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">:</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delegate the task to another agent with a specific task description. The string \</span>
<span class="sd">        task description is required to specify what the target agent should do.</span>

<span class="sd">        Args:</span>
<span class="sd">            task_description: A detailed description of the task to be performed by the target agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># wrap the task description in an AI message (alternatively, you can use a user message)</span>
        <span class="n">task_description_message</span> <span class="o">=</span> <span class="n">AIMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">task_description</span><span class="p">)</span>
        <span class="c1"># this is a copy of the current state, but instead of the conversation history</span>
        <span class="c1"># it will contain the single task description message</span>
        <span class="n">agent_input</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">task_description_message</span><span class="p">]}</span>
        <span class="c1"># `Command` is an advanced graph navigation method;</span>
        <span class="c1"># it allows to execute a required action in the graph</span>
        <span class="c1"># immediately without the need to explicitly define</span>
        <span class="c1"># rooting logic for it; for example, instead of defining</span>
        <span class="c1"># a separate conditional node in the graph</span>
        <span class="c1"># that would check to which agent to transfer the task,</span>
        <span class="c1"># we can just use `Command` to send the task to the agent directly,</span>
        <span class="c1"># which also helps to keep the state cleaner</span>

        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
            <span class="c1"># that is the action to perform;</span>
            <span class="c1"># `Send` is a special command that sends the input</span>
            <span class="c1"># to the specified agent -- it&#39;s like calling</span>
            <span class="c1"># `agent_name.invoke(agent_input)` but in the graph context</span>
            <span class="n">goto</span><span class="o">=</span><span class="p">[</span><span class="n">Send</span><span class="p">(</span><span class="n">agent_name</span><span class="p">,</span> <span class="n">agent_input</span><span class="p">)],</span>
            <span class="c1"># that says that the required agent is in the parent context</span>
            <span class="c1"># (so in the main graph) and not in the local context</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">handoff_tool</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># init tools</span>
<span class="n">assign_to_scheduler_agent_with_description</span> <span class="o">=</span> <span class="n">create_task_description_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;scheduler_agent&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Assign task to the scheduler agent.&quot;</span>
<span class="p">)</span>

<span class="n">assign_to_creative_agent_with_description</span> <span class="o">=</span> <span class="n">create_task_description_handoff_tool</span><span class="p">(</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;creative_agent&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Assign task to the creative agent.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we are ready to create our supervisor. The <code class="docutils literal notranslate"><span class="pre">create_supervisor</span></code> function will take care about all the routing, you should only give it the agents to manage and our custom handoff tools so that it generates the tasks explicitly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph_supervisor</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_supervisor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_lama_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are the head of a team of agents, and your task is to set up meetings </span><span class="se">\</span>
<span class="s2">and prepare agendas for them. You have two agents at your disposal:</span>
<span class="s2">- **Scheduler Agent**: Responsible for checking participant availability and finding common time slots. </span><span class="se">\</span>
<span class="s2">If it will return you several available slots, pick one yourself.</span>
<span class="s2">- **Creative Agent**: Responsible for preparing meeting agendas based on the current project status.</span>
<span class="s2">Your task is to delegate tasks to these agents based on the user requests. </span><span class="se">\</span>
<span class="s2">When delegating the task, necessarily provide a detailed task description </span><span class="se">\</span>
<span class="s2">to the agent so it knows what to do. Do not stop until the task is completed.</span>

<span class="s2">Assign work to one agent at a step, do not call the agents in parallel. </span><span class="se">\</span>
<span class="s2">Do not do any work yourself.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">coordinator</span> <span class="o">=</span> <span class="n">create_supervisor</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span>
        <span class="n">scheduler_agent</span><span class="p">,</span>
        <span class="n">creative_agent</span>
    <span class="p">],</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
        <span class="n">assign_to_scheduler_agent_with_description</span><span class="p">,</span>
        <span class="n">assign_to_creative_agent_with_description</span>
    <span class="p">],</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">_lama_prompt</span><span class="p">,</span>
    <span class="n">supervisor_name</span><span class="o">=</span><span class="s2">&quot;coordinator&quot;</span><span class="p">,</span>
    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;full_history&quot;</span><span class="p">,</span>  <span class="c1"># keep the full history of the conversation</span>
    <span class="n">add_handoff_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># add messages about task handoff to the conversation</span>
    <span class="n">add_handoff_back_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># add messages about task handoff back to the coordinator</span>
    <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">lama</span> <span class="o">=</span> <span class="n">coordinator</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_graph</span><span class="p">(</span><span class="n">lama</span><span class="p">,</span> <span class="s2">&quot;lama.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/380f4b4a9aff47fcd988ba003a3d57b686d87fef3c041ed92985ae2817fb53c9.png" src="../../../../_images/380f4b4a9aff47fcd988ba003a3d57b686d87fef3c041ed92985ae2817fb53c9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_agent</span><span class="p">(</span><span class="n">lama</span><span class="p">,</span> <span class="s2">&quot;Schedule a meeting with Jake, Mike, and Lucy to discuss the project status and prepare an agenda for it.&quot;</span><span class="p">,</span> <span class="n">recursion_limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

Schedule a meeting with Jake, Mike, and Lucy to discuss the project status and prepare an agenda for it.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator
Tool Calls:
  transfer_to_scheduler_agent (chatcmpl-tool-6f0d91759b274420ad60c0d74fb66b7f)
 Call ID: chatcmpl-tool-6f0d91759b274420ad60c0d74fb66b7f
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_to_scheduler_agent

Successfully transferred to scheduler_agent


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-4504b05275ac4416960888698a5d6b6c)
 Call ID: chatcmpl-tool-4504b05275ac4416960888698a5d6b6c
  Args:
    name: Jake


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;12:00-13:00&quot;, &quot;12:30-13:30&quot;, &quot;16:30-17:30&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-e749004dfc44471097bc9f1dce279275)
 Call ID: chatcmpl-tool-e749004dfc44471097bc9f1dce279275
  Args:
    name: Mike


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;12:00-13:00&quot;, &quot;13:00-14:00&quot;, &quot;13:30-14:30&quot;, &quot;15:30-16:30&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-f03892c08c1348be84fcf6a64389dc38)
 Call ID: chatcmpl-tool-f03892c08c1348be84fcf6a64389dc38
  Args:
    name: Lucy


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;11:30-12:30&quot;, &quot;13:30-14:30&quot;, &quot;14:00-15:00&quot;, &quot;15:30-16:30&quot;, &quot;16:30-17:30&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent

The common available time slots for Jake, Mike, and Lucy are 12:00-13:00 and 16:30-17:30.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent

Transferring back to coordinator
Tool Calls:
  transfer_back_to_coordinator (f9f5436f-ed42-48ff-a444-09f32c0325b9)
 Call ID: f9f5436f-ed42-48ff-a444-09f32c0325b9
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_back_to_coordinator

Successfully transferred back to coordinator


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator
Tool Calls:
  transfer_to_creative_agent (chatcmpl-tool-7bc12cd1fa694340a495e7cd18cab1fc)
 Call ID: chatcmpl-tool-7bc12cd1fa694340a495e7cd18cab1fc
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_to_creative_agent

Successfully transferred to creative_agent


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: creative_agent
Tool Calls:
  retrieve_project_information (chatcmpl-tool-b135d1bc0d7d42b3a919c5d047c9796b)
 Call ID: chatcmpl-tool-b135d1bc0d7d42b3a919c5d047c9796b
  Args:
    query: project status and goals


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: retrieve_project_information


Current Project: Mobile App Redesign (Q2 2024)

Status: In Progress (Week 6 of 12)

Recent Milestones:
- User research completed (Week 3)
- Wireframes approved by stakeholders (Week 5)
- Initial design mockups completed (Week 6)

Upcoming Milestones:
- Prototype development (Week 8-10)
- User testing sessions (Week 11)
- Final design handoff (Week 12)

Current Blockers:
- Waiting for brand guidelines update from marketing team
- Need approval on accessibility requirements

Budget Status: 70% utilized, on track
Timeline Status: Slightly behind schedule due to extended user research phase



==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: creative_agent

Here is the meeting agenda:

Meeting Title: Mobile App Redesign Project Status Update

Attendees: Jake, Mike, Lucy

Objective: To discuss the current project status, address any blockers, and align on the project goals.

Agenda:

1. Introduction and Project Overview (5 minutes)
2. Recent Milestones and Progress (15 minutes)
	* Review of user research findings
	* Discussion of wireframes and design mockups
3. Upcoming Milestones and Timeline (15 minutes)
	* Review of prototype development and user testing plans
	* Discussion of final design handoff and project completion
4. Current Blockers and Challenges (10 minutes)
	* Discussion of brand guidelines update from marketing team
	* Review of accessibility requirements and approval status
5. Budget and Timeline Status (10 minutes)
	* Review of budget utilization and timeline progress
6. Next Steps and Action Items (5 minutes)
	* Assignment of tasks and responsibilities
	* Review of deadlines and milestones

Note: The agenda is tailored to the specific project needs and goals, and is designed to facilitate a productive and efficient meeting.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: creative_agent

Transferring back to coordinator
Tool Calls:
  transfer_back_to_coordinator (9e9bbab7-b8bc-421c-b16b-b72182d149a3)
 Call ID: 9e9bbab7-b8bc-421c-b16b-b72182d149a3
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_back_to_coordinator

Successfully transferred back to coordinator


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator

The meeting with Jake, Mike, and Lucy is scheduled for 12:00-13:00 to discuss the project status. The agenda for the meeting is prepared and includes the following topics:

Meeting Title: Mobile App Redesign Project Status Update

Attendees: Jake, Mike, Lucy

Objective: To discuss the current project status, address any blockers, and align on the project goals.

Agenda:

1. Introduction and Project Overview (5 minutes)
2. Recent Milestones and Progress (15 minutes)
	* Review of user research findings
	* Discussion of wireframes and design mockups
3. Upcoming Milestones and Timeline (15 minutes)
	* Review of prototype development and user testing plans
	* Discussion of final design handoff and project completion
4. Current Blockers and Challenges (10 minutes)
	* Discussion of brand guidelines update from marketing team
	* Review of accessibility requirements and approval status
5. Budget and Timeline Status (10 minutes)
	* Review of budget utilization and timeline progress
6. Next Steps and Action Items (5 minutes)
	* Assignment of tasks and responsibilities
	* Review of deadlines and milestones
</pre></div>
</div>
</div>
</div>
<h2 id="human">3. Human in The Loop 👾🤖🧐👾</h2>
<p>Next thing we want to learn to do is adding human input <strong>within</strong> our pipeline. In multi-agent environments, involving a human can help handle ambiguous situations, resolve issues AI for some reason can’t, or just approve/reject AI suggestion. By combining the strengths of both humans and AI agents, we can achieve more reliable and robust solutions.</p>
<p>In our pipeline, when the time slot is found and an agenda is prepared, we will ask for a human approval before finalizing the task. For that, we will just need to insert a special node for receiving human input (more below).</p>
<p>Actually, under the hood the <code class="docutils literal notranslate"><span class="pre">create_supervisor</span></code> function creates yet another ReACT agent, but instead of usual tools, it has the agent executors (well technically, he has tools to call them):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># simplified but conceptually correct</span>
<span class="n">coordinator</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
        <span class="n">assign_to_scheduler_agent_with_description</span><span class="p">,</span>
        <span class="n">assign_to_creative_agent_with_description</span>
    <span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">_lama_prompt</span><span class="p">,</span>    <span class="c1"># reuse the prompt</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;coordinator&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now, you remember that we added a so-called <code class="docutils literal notranslate"><span class="pre">pre_mode_hook</span></code> to our <a class="reference internal" href="#agents"><span class="xref myst">basic agent</span></a> (also a ReACT agent) to handle the absence of explicit planning. It added a custom node before the agent was invoked. Now we’ll do the opposite and add a <code class="docutils literal notranslate"><span class="pre">post_model_hook</span></code> to our coordinator which will be called after the agent generation. It will check if the coordinator decided to exit and will redirect the system to the human input node before exiting.</p>
<p>How will we know if the coordinator decided to exit? It’s actually really easy: a default ReACT agent can either call tools, or exit with a ready response. So if the latest message (that is the one from the coordinator) does not contain tool calls, it means that the coordinator has decided to exit and its response is contained in the usual <code class="docutils literal notranslate"><span class="pre">.content</span></code> property. It is this response that we will be redirecting to the human for approval.</p>
<p>Creating a human-in-the loop functionality is fairly easy with LangGraph: you just need to stop the workflow with a special <code class="docutils literal notranslate"><span class="pre">interrupt()</span></code> function and then return a familiar to us <code class="docutils literal notranslate"><span class="pre">Command</span></code> to continue it from the point we point to. In our case, we will redirect the workflow back to the coordinator for it to decide which changes should be made based on the human feedback, or execute the corresponding tools in case the generation is still running.</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">interrupt()</span></code> function is executed, it actually stops the pipeline until the human input is given and it works such that the whole node where this function was called is re-executed; that is why it is highly recommended to have a separate node that handles human input in order to not regenerate anything that has already been done. In our case, we follow this principle just fine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">interrupt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.checkpoint.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemorySaver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">END</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">maybe_ask_human</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="n">last_message</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">last_message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>   <span class="c1"># just resume the graph execution</span>
    <span class="n">ai_message</span> <span class="o">=</span> <span class="n">last_message</span><span class="o">.</span><span class="n">content</span>
    <span class="c1"># when interrupting the graph, we can also show some text</span>
    <span class="c1"># to the user; it the user prints &quot;ok&quot;, it means that the user</span>
    <span class="c1"># approves the suggestion; this is a fairly simple way to</span>
    <span class="c1"># detect whether the user approves the suggestion or not,</span>
    <span class="c1"># we adopt it here for simplicity; we might have as well</span>
    <span class="c1"># used an LLM or a smaller LM-classifier</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">interrupt</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Here&#39;s my suggestion:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">ai_message</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Waiting for approval. Print &#39;ok&#39; if it works for you.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
    <span class="c1"># stop if the suggestion works</span>
        <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
            <span class="n">goto</span><span class="o">=</span><span class="n">END</span><span class="p">,</span>
            <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">response</span><span class="p">)}</span>  <span class="c1"># this will update the state</span>
        <span class="p">)</span>
    <span class="c1"># redirect back to the coordinator with the human response otherwise</span>
    <span class="k">return</span> <span class="n">Command</span><span class="p">(</span>
        <span class="n">goto</span><span class="o">=</span><span class="s2">&quot;coordinator&quot;</span><span class="p">,</span>
        <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">HumanMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">response</span><span class="p">)},</span>  <span class="c1"># this will update the state</span>
        <span class="n">graph</span><span class="o">=</span><span class="n">Command</span><span class="o">.</span><span class="n">PARENT</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">interrupt()</span></code> stops the pipeline, LangGraph needs to remember where it left off to resume from there. To enable this, we use the <code class="docutils literal notranslate"><span class="pre">InMemorySaver</span></code> – the same tool for checkpointing between the sessions we used in the <a class="reference internal" href="../0805/0805.html#checkpointing"><span class="std std-ref">lab about basic chatbots</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_lama_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are the head of a team of agents, and your task is to set up meetings </span><span class="se">\</span>
<span class="s2">and prepare agendas for them. You have two agents at your disposal:</span>
<span class="s2">- **Scheduler Agent**: Responsible for checking participant availability and finding common time slots. </span><span class="se">\</span>
<span class="s2">If it will return you several available slots, pick one yourself.</span>
<span class="s2">- **Creative Agent**: Responsible for preparing meeting agendas based on the current project status.</span>
<span class="s2">Your task is to delegate tasks to these agents based on the user requests. </span><span class="se">\</span>
<span class="s2">When delegating the task, necessarily provide a detailed task description </span><span class="se">\</span>
<span class="s2">to the agent so it knows what to do. Do not stop until the task is completed.</span>

<span class="s2">Assign work to one agent at a step, do not call the agents in parallel. </span><span class="se">\</span>
<span class="s2">Do not do any work yourself.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">coordinator_h</span> <span class="o">=</span> <span class="n">create_supervisor</span><span class="p">(</span>
    <span class="n">agents</span><span class="o">=</span><span class="p">[</span>
        <span class="n">scheduler_agent</span><span class="p">,</span>
        <span class="n">creative_agent</span>
    <span class="p">],</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
        <span class="n">assign_to_scheduler_agent_with_description</span><span class="p">,</span>
        <span class="n">assign_to_creative_agent_with_description</span>
    <span class="p">],</span>
    <span class="n">model</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">_lama_prompt</span><span class="p">,</span>
    <span class="n">supervisor_name</span><span class="o">=</span><span class="s2">&quot;coordinator&quot;</span><span class="p">,</span>
    <span class="n">output_mode</span><span class="o">=</span><span class="s2">&quot;full_history&quot;</span><span class="p">,</span>  <span class="c1"># keep the full history of the conversation</span>
    <span class="n">add_handoff_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># add messages about task handoff to the conversation</span>
    <span class="n">add_handoff_back_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># add messages about task handoff back to the coordinator</span>
    <span class="n">parallel_tool_calls</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">post_model_hook</span><span class="o">=</span><span class="n">maybe_ask_human</span>  <span class="c1"># ask the human for confirmation</span>
<span class="p">)</span>

<span class="n">lama_h</span> <span class="o">=</span> <span class="n">coordinator_h</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">InMemorySaver</span><span class="p">())</span>    <span class="c1"># checkpointer here</span>
</pre></div>
</div>
</div>
</div>
<p>When you are streaming graph execution and it gets interrupted, it returns a special event with an <code class="docutils literal notranslate"><span class="pre">&quot;__interrupt__&quot;</span></code> key that contains the content we passed to the <code class="docutils literal notranslate"><span class="pre">interrupt()</span></code> function.</p>
<p>To the best of my knowledge, the only way to detect an interruption automatically is to directly check for this key. In the wrapper function below, we check if there is an interrupt and prompt the user to answer the question if there is. The value under this key will contain a tuple with a single (in our case) <code class="docutils literal notranslate"><span class="pre">Interrupt</span></code> object with our text under the <code class="docutils literal notranslate"><span class="pre">.value</span></code> property.</p>
<p>After we received an answer from the human, we resume our workflow with a <code class="docutils literal notranslate"><span class="pre">Command</span></code>. It will throw us back to the node where the <code class="docutils literal notranslate"><span class="pre">interrupt()</span></code> function was called, and from there we will retrieve the answer and pass it back to the coordinator with yet another <code class="docutils literal notranslate"><span class="pre">Command</span></code>.</p>
<p>Here is the tricky part: since the interruption actually stops the pipeline, we should <strong>run it anew</strong> – and that is why we need the checkpointer because it would have otherwise started from the very beginning. So to keep the pipeline even with the interruption running without our intervention, we wrap the launching into a loop; it will initially be run with the first request form the user, and then whenever an interruption is encountered, we will update the input to whatever the user has answered and the loop will rerun this pipeline with this new updated input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># wrapper for pretty print</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_agent_with_checkpoint</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">recursion_limit</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="c1"># initial input</span>
    <span class="n">pipeline_input</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">)]</span>
    <span class="p">}</span>
    <span class="n">shown_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># this is needed to handle user interruptions</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
            <span class="n">pipeline_input</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;configurable&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="s2">&quot;9&quot;</span>
                <span class="p">},</span>  
                <span class="s2">&quot;recursion_limit&quot;</span><span class="p">:</span> <span class="n">recursion_limit</span>
            <span class="p">},</span>
            <span class="n">stream_mode</span><span class="o">=</span><span class="s2">&quot;values&quot;</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;__interrupt__&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">question</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;__interrupt__&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="c1"># retrieve the question</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>    <span class="c1"># get the answer from the user</span>
                <span class="n">pipeline_input</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="n">resume</span><span class="o">=</span><span class="n">answer</span><span class="p">)</span> <span class="c1"># update the input with the answer</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;================================== Interruption ==================================&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;messages&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">HumanMessage</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">content</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
                    <span class="k">return</span>  <span class="c1"># interrupt the execution if the user approves the suggestion</span>
                <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">shown_messages</span><span class="p">:</span>
                        <span class="n">shown_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                        <span class="n">message</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">run_agent_with_checkpoint</span><span class="p">(</span><span class="n">lama_h</span><span class="p">,</span> <span class="s2">&quot;Schedule a meeting for Jake and Mike to discuss the project status and prepare an agenda for it.&quot;</span><span class="p">,</span> <span class="n">recursion_limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

Schedule a meeting for Jake and Mike to discuss the project status and prepare an agenda for it.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator
Tool Calls:
  transfer_to_scheduler_agent (chatcmpl-tool-2476e724b2a44b1689e776d855eb7c21)
 Call ID: chatcmpl-tool-2476e724b2a44b1689e776d855eb7c21
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_to_scheduler_agent

Successfully transferred to scheduler_agent


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-dc42de8798be42d09d6144b29d1caddc)
 Call ID: chatcmpl-tool-dc42de8798be42d09d6144b29d1caddc
  Args:
    name: Jake


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;10:30-11:30&quot;, &quot;15:30-16:30&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-bbef9ca57c394ddb902c58a819a31e01)
 Call ID: chatcmpl-tool-bbef9ca57c394ddb902c58a819a31e01
  Args:
    name: Mike


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;10:00-11:00&quot;, &quot;12:30-13:30&quot;, &quot;14:30-15:30&quot;, &quot;15:30-16:30&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent

The meeting will be scheduled for 15:30-16:30. The agenda will include:

1. Introduction and project overview
2. Review of current project status
3. Discussion of any challenges or issues
4. Review of upcoming milestones and deadlines
5. Action items and next steps

Please let me know if you need any further assistance.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent

Transferring back to coordinator
Tool Calls:
  transfer_back_to_coordinator (a7bf902f-69a9-482d-8512-fcfe8f4abaeb)
 Call ID: a7bf902f-69a9-482d-8512-fcfe8f4abaeb
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_back_to_coordinator

Successfully transferred back to coordinator


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator
Tool Calls:
  transfer_to_creative_agent (chatcmpl-tool-83625debd62640f4a355517660a9551c)
 Call ID: chatcmpl-tool-83625debd62640f4a355517660a9551c
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_to_creative_agent

Successfully transferred to creative_agent


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: creative_agent
Tool Calls:
  retrieve_project_information (chatcmpl-tool-973f3c5a71cc41898120c921ff682847)
 Call ID: chatcmpl-tool-973f3c5a71cc41898120c921ff682847
  Args:
    query: project status


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: retrieve_project_information


Current Project: Mobile App Redesign (Q2 2024)

Status: In Progress (Week 6 of 12)

Recent Milestones:
- User research completed (Week 3)
- Wireframes approved by stakeholders (Week 5)
- Initial design mockups completed (Week 6)

Upcoming Milestones:
- Prototype development (Week 8-10)
- User testing sessions (Week 11)
- Final design handoff (Week 12)

Current Blockers:
- Waiting for brand guidelines update from marketing team
- Need approval on accessibility requirements

Budget Status: 70% utilized, on track
Timeline Status: Slightly behind schedule due to extended user research phase



==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: creative_agent

The meeting will be scheduled for 15:30-16:30. The agenda will include:

1. Introduction and project overview
2. Review of current project status
3. Discussion of any challenges or issues
4. Review of upcoming milestones and deadlines
5. Action items and next steps

Please let me know if you need any further assistance.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: creative_agent

Transferring back to coordinator
Tool Calls:
  transfer_back_to_coordinator (e22d05f9-60e8-44fe-91a7-bf7f2ded3e18)
 Call ID: e22d05f9-60e8-44fe-91a7-bf7f2ded3e18
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_back_to_coordinator

Successfully transferred back to coordinator


================================== Interruption ==================================
Here&#39;s my suggestion:

The meeting between Jake and Mike has been scheduled for 15:30-16:30 to discuss the project status. The agenda has been prepared and includes:

1. Introduction and project overview
2. Review of current project status
3. Discussion of any challenges or issues
4. Review of upcoming milestones and deadlines
5. Action items and next steps

Please let me know if you need any further assistance.

Waiting for approval. Print &#39;ok&#39; if it works for you.
================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

nah this time won&#39;t work, give me something next week


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator
Tool Calls:
  transfer_to_scheduler_agent (chatcmpl-tool-3db8020148be4d93a1b2c69e5ab59b3e)
 Call ID: chatcmpl-tool-3db8020148be4d93a1b2c69e5ab59b3e
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_to_scheduler_agent

Successfully transferred to scheduler_agent


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-13941e156619494897eb30332ccc7934)
 Call ID: chatcmpl-tool-13941e156619494897eb30332ccc7934
  Args:
    name: Jake


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;12:00-13:00&quot;, &quot;15:30-16:30&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent
Tool Calls:
  check_calendar_availability (chatcmpl-tool-d42095697b9449b38886712d2dd214a1)
 Call ID: chatcmpl-tool-d42095697b9449b38886712d2dd214a1
  Args:
    name: Mike


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: check_calendar_availability

[&quot;10:30-11:30&quot;, &quot;12:30-13:30&quot;, &quot;14:00-15:00&quot;, &quot;14:30-15:30&quot;, &quot;16:00-17:00&quot;]


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent

The meeting will be scheduled for 12:30-13:30. The agenda will include:

1. Introduction and project overview
2. Review of current project status
3. Discussion of any challenges or issues
4. Review of upcoming milestones and deadlines
5. Action items and next steps

Please let me know if you need any further assistance.


==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: scheduler_agent

Transferring back to coordinator
Tool Calls:
  transfer_back_to_coordinator (6461dae9-a6b5-44e9-b544-fe3d288b3f95)
 Call ID: 6461dae9-a6b5-44e9-b544-fe3d288b3f95
  Args:


=================================<span class=" -Color -Color-Bold"> Tool Message </span>=================================
Name: transfer_back_to_coordinator

Successfully transferred back to coordinator


================================== Interruption ==================================
Here&#39;s my suggestion:

The meeting will be scheduled for 12:30-13:30. The agenda will include:

1. Introduction and project overview
2. Review of current project status
3. Discussion of any challenges or issues
4. Review of upcoming milestones and deadlines
5. Action items and next steps

Please let me know if you need any further assistance.

Waiting for approval. Print &#39;ok&#39; if it works for you.
==================================<span class=" -Color -Color-Bold"> Ai Message </span>==================================
Name: coordinator

The meeting will be scheduled for 12:30-13:30. The agenda will include:

1. Introduction and project overview
2. Review of current project status
3. Discussion of any challenges or issues
4. Review of upcoming milestones and deadlines
5. Action items and next steps

Please let me know if you need any further assistance.


================================<span class=" -Color -Color-Bold"> Human Message </span>=================================

ok
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./sessions/block2_core_topics/pt1_business/2705"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../2205.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">22.05. Virtual Assistants Pt. 3: Multi-agent Environment</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../2005/2005.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">20.05. RAG Chatbot Pt. 2 📚</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Maksim Shmalts
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link footer-icon" href="https://github.com/maxschmaltz/Course-LLM-based-Assistants" aria-label="GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 18 18">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
</svg>
</a>
              <a class="muted-link footer-icon" href="https://github.com/maxschmaltz/Course-LLM-based-Assistants/issues/new" aria-label="Issues"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 18 18">
  <path d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm.1-6.995a.905.905 0 0 1 1.8 0l-.35 4.5a.55.55 0 0 1-1.1 0l-.35-4.5z"/>
</svg>
</a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">27.05. Multi-agent Environment 👾🤖👾</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li><a class="reference internal" href="#executor-agents">Executor Agents</a></li>
<li><a class="reference internal" href="#coordinator-agent">Coordinator Agent</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    </body>
</html>